version: 1
frontend:
  phases:
    preBuild:
      commands:
        - "echo '=== Starting Amplify Build with clean cache ==='"
        - "nvm install 22.16.0"
        - "nvm use 22.16.0"
        - "echo 'Node version: $(node -v)'"
        - "echo 'NPM version: $(npm -v)'"
        - "echo 'üîÑ Clearing previous build cache...'"
        - "rm -rf node_modules .next .next/standalone || true"
        - "export NODE_OPTIONS='--max-old-space-size=12288'"  # 12 GB heap
        - "npm ci --legacy-peer-deps"
    build:
      commands:
        - "echo 'üèó Running Next.js production build (standalone)'"
        - "npm run build"
        - "echo '‚úÖ Build completed'"
  artifacts:
    baseDirectory: .next/standalone
    files:
      - "**/*"
  cache:
    paths:
      - "node_modules//*"
appRoot: .